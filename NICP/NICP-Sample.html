<script type="text/javascript">
    RED.nodes.registerType("FCF-Sample", {
        category: "FCF",
        color: "#9999cc",
        defaults: {
            name: {
                value: "",
            },
            propertyType: {
                value: ""
            },
            property: {
                value: "",
                required: true
            },
        },
        inputs: 1,
        outputs: 1,
        icon: "debug.png",
        paletteLabel: "Sample",
        label: function () {
            let labelName = "Sample";
            if (this.name) {
                return `${labelName} : ${this.name}`;
            }
            else {
                return labelName;
            }
        },
        oneditprepare: function () { //當使用者打開此節點的Edit dialog畫面時要做的事
            const node = this;
            // 將普通的input表單設定成Node-RED的typedInput表單，同時也是做初始化的動作
            // default是設定預設值，如果上方defaults也有設定的話，那就會蓋掉這裡的，這裡的就會沒效果
            // 有設定typeField的話，會把這個#node-input-property元素的type值也存到設定的typeField的元素，也就是再存一份到另一個元素啦，但這時typeField這元素的input在畫面上就會不見
            $.when(
                // 取得這個類型的節點，此節點是NICP-ConditionalTrigger，那他就只會從Context File拿NICP-ConditionalTrigger類型的節點
                $.getJSON(`context/flow/${node.z}`)
            ).then((data1) => {
                let theNodeConfigDatasArray;
                // 檢查Context檔案系統中是否儲存這個類型的節點
                try {
                    theNodeConfigDatasArray = JSON.parse(data1.xanxusContext[this.type].msg);
                } catch (TypeError) {
                    console.log("抱歉，目前ContextFile中還沒有這個節點的資料唷！");
                    console.log(TypeError);
                    return;
                }
                console.log(`theNodeConfigDatasArray:`);
                console.log(theNodeConfigDatasArray[1].property);
                $("#node-input-property").val(theNodeConfigDatasArray[1].property);
            }).fail(function (problem) {
                console.log(problem);
            });
        },
        oneditsave: function () {//當使用者在Edit dialog設置(編輯)完成，按下Done要做的事
            const node = this;
            node.property = $("#node-input-property").val();
            // 這裡#node-input-bot就回存#node-input-property元素的type值了
            // node.propertyType = $("#node-input-bot").val();

        },
        oneditcancel: function () {//當使用者在Edit dialog按下Cancel要做的事
        },
        oneditdelete: function () {
        },
        onpaletteadd: function () {//此節點只要存在於palette(就是左邊直的那排，還沒拉出來)就會做的事，還沒拉出來也會觸發，重新整理也會觸發
        },
        onpaletteremove: function () {// 沒試過，但應該是從palette移除就會觸發
        }
    });

</script>

<script type="text/x-red" data-template-name="FCF-Sample">
    <div class="form-row">
        <!-- 節點名稱 -->
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> Property</label>
        <input type="text" id="node-input-property" style="width: 70%"/>
    </div>
    <!-- 定義裝表單項目的容器? -->
	<div class="form-row node-input-rule-container-row">
		<ol id="node-input-rule-container"></ol>
	</div>
</script>

<script type="text/x-red" data-help-name="FCF-Sample">
</script>