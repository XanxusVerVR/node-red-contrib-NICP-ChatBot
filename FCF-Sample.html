<script type="text/javascript">
    RED.nodes.registerType("FCF-Sample", {
        category: "input",
        color: "#9999cc",
        defaults: {
            name: {
                value: "",
            },
            propertyType: {
                value: "msg"
            },
            property: {
                value: "payload",
                required: true,
                validate: RED.validators.typedInput("propertyType")
            },
            bot: {
                value: "",
                type: "FCF-facebook-node",
                required: true
            },
            startedButtonPostbackPayload: {
                value: "",
            },
            greetings: {
                value: [{
                    locale: "",
                    text: ""
                }]
            }
        },
        inputs: 1,
        outputs: 0,
        icon: "debug.png",
        paletteLabel: "Sample",
        label: function () {
            let labelName = "Sample";
            if (this.name) {
                return `${labelName} : ${this.name}`;
            }
            else {
                return labelName;
            }
        },
        oneditprepare: function () {
            let node = this;

            //取得config節點的方法
            //參考資料 https://reurl.cc/WNKQx
            //取得在編輯視窗被選中的那個config節點的ID
            let configNodeID = $("#node-input-bot").val();
            //藉由那個config節點的id來取得它的內容
            let configNode = RED.nodes.node(configNodeID);

            // $("#node-input-property").typedInput({
            //     default: this.propertyType || "msg", types: ["msg", "flow", "global", "str", "num", "bool", "json", "bin", "date", "jsonata", "env", "re"]
            // });

            // $("#node-input-rule-container").css("min-height", "300px").css("min-width", "450px").editableList({
            //     addItem: function (container, i, _greetings) {
            //         if (!_greetings.hasOwnProperty("locale")) {
            //             _greetings.locale = "default";
            //             _greetings.text = "Hello!";
            //         }
            //         let localeSelectField = $("<select/>", { class: "node-input-locale", style: "width:110px; margin-right:10px;" }).appendTo(container);
            //         let selectOptions = [];
            //         for (let i = 0; i < locale.length; i++) {
            //             selectOptions.push({
            //                 value: locale[i],
            //                 text: locale[i]
            //             });
            //         }
            //         for (let i = 0; i < selectOptions.length; i++) {
            //             localeSelectField.append($("<option></option>").val(selectOptions[i].value).text(selectOptions[i].text));
            //         }
            //         let propertyValue2 = $("<input/>", { class: "node-input-text", type: "text", value: _greetings.text })
            //             .appendTo(container);

            //         localeSelectField.val(_greetings.locale);

            //     },
            //     removable: true,
            //     sortable: true
            // })
            // for (let i = 0; i < node.greetings.length; i++) {
            //     $("#node-input-rule-container").editableList("addItem", node.greetings[i]);
            // }
        },
        oneditsave: function () {
            // let node = this;
            // let items = $("#node-input-rule-container").editableList("items");
            // node.greetings = [];//這你一定要創造一個node.greetings，跟上面定義的屬性名稱要一樣，這樣才存得進去
            // items.each(function (i) {
            //     let data = $(this);
            //     node.greetings.push({
            //         locale: data.find(".node-input-locale").val(),//這裡的locale和text也是和上面定義的屬性要一樣
            //         text: data.find(".node-input-text").val()
            //     });
            // });
            // this.propertyType = $("#node-input-property").typedInput("type");
        }
    });

</script>

<script type="text/x-red" data-template-name="FCF-Sample">
    <div class="form-row">
        <!-- 節點名稱 -->
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="switch.label.property"></span></label>
        <input type="text" id="node-input-property" style="width: 70%"/>
        <input type="hidden" id="node-input-outputs"/>
    </div>
    <div class="form-row">
        <label for="node-input-bot"><i class="icon-bookmark"></i> Bot</label>
        <input type="text" id="node-input-bot" placeholder="Bot">
    </div>
    <!-- 定義裝表單項目的容器? -->
	<div class="form-row node-input-rule-container-row">
		<ol id="node-input-rule-container"></ol>
	</div>
</script>

<script type="text/x-red" data-help-name="FCF-Sample">
</script>