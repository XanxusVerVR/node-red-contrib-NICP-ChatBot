<script type="text/javascript">
	RED.nodes.registerType("lower-case", {
		category: "input",
		color: "#BBFF66",
		defaults: {
			name: {
				value: ""
			},
			datas: {
				value: [{
					a: "str",
					b: "Xanxus"
				}]
			}
		},
		inputs: 1,
		outputs: 1,
		paletteLabel: "lower-case",
		icon: "file.png",
		label: function () {
			let labelName = "Lower Case";
			if (this.name) {
				return `${labelName} : ${this.name}`;
			}
			else {
				return labelName;
			}
		},

		oneditprepare: function () {
			function resizeRule(rule) {//這function不用也可
				let newWidth = rule.width();
				rule.find(".red-ui-typedInput").typedInput("width", newWidth - 130);
			}
			$("#node-input-rule-container").css("min-height", "300px").css("min-width", "450px").editableList({
				addItem: function (container, i, data) {
					if (!data.hasOwnProperty("a")) {
						data.a = "str";
						data.b = "Xanxus";
					}
					container.css({//這行不用也可
						overflow: "hidden"
						// whiteSpace: "nowrap"//設定是否換行
					});
					// let row1 = $("<div/>").appendTo(container);
					let propertyValue = $("<input/>", { class: "node-input-xanxusInput", type: "text", value: data.a })
						.appendTo(container);
					let propertyValue2 = $("<input/>", { class: "node-input-xanxusInput2", type: "text", value: data.b })
						.appendTo(container);
					propertyValue.val(data.a);
					propertyValue2.val(data.b);
					resizeRule(container);//這行不用也可
				},
				resizeItem: resizeRule,//這行不用也可
				removable: true,
				sortable: true
			})
			for (let i = 0; i < this.datas.length; i++) {
				let data = this.datas[i];
				$("#node-input-rule-container").editableList("addItem", data);
			}
		},
		oneditsave: function () {
			let datas = $("#node-input-rule-container").editableList("items");
			let node = this;
			node.datas = [];
			datas.each(function (i) {
				let data = $(this);
				let r = {
					a: data.find(".node-input-xanxusInput").val(),
					b: data.find(".node-input-xanxusInput2").val()
				};
				node.datas.push(r);
			});
		},
		//裡面不用程式碼item也可以動
		oneditresize: function (size) {
			let rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
			let height = size.height;
			for (let i = 0; i < rows.size(); i++) {
				height -= $(rows[i]).outerHeight(true);
			}
			let editorRow = $("#dialog-form>div.node-input-rule-container-row");
			height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")));

			$("#node-input-rule-container").editableList("height", height);
		}
	});
</script>

<!-- 定義此節點的表單元件 -->
<script type="text/x-red" data-template-name="lower-case">
	<!-- 節點名稱 -->
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
    </div>

	<!-- 定義裝表單項目的容器? -->
	<div class="form-row node-input-rule-container-row">
		<ol id="node-input-rule-container"></ol>
	</div>





    <!-- <div class="form-row" style="position: relative; margin-bottom: 0px;">
        <label for="node-input-template"><i class="fa fa-file-code-o"></i> <span>Template</span></label>
        <input type="hidden" id="node-input-template" autofocus="autofocus">
        <div style="position: absolute; right:0;display:inline-block; text-align: right; font-size: 0.8em;">
            <span>Syntax Highlight</span>:
            <select id="node-input-format" style="width:110px; font-size: 10px !important;  height: 24px; padding:0;">
                <option value="handlebars">mustache</option>
                <option value="html">HTML</option>
                <option value="json">JSON</option>
                <option value="javascript">Javascript</option>
                <option value="css">CSS</option>
                <option value="markdown">Markdown</option>
                <option value="yaml">YAML</option>
                <option value="text">Text</option>
            </select>
        </div>
	</div> -->
	<!-- 沒有這個div會沒有文字輸入區塊 -->
    <!-- <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-template-editor" ></div>
	</div> -->





	<!-- <div class="form-row" style="position: relative; margin-bottom: 0px;">
        <label for="node-input-template2"><i class="fa fa-file-code-o"></i> <span>Template</span></label>
        <input type="hidden" id="node-input-template2" autofocus="autofocus">
        <div style="position: absolute; right:0;display:inline-block; text-align: right; font-size: 0.8em;">
            <span>Syntax Highlight</span>:
            <select id="node-input-format2" style="width:110px; font-size: 10px !important;  height: 24px; padding:0;">
                <option value="handlebars">mustache</option>
                <option value="html">HTML</option>
                <option value="json">JSON</option>
                <option value="javascript">Javascript</option>
                <option value="css">CSS</option>
                <option value="markdown">Markdown</option>
                <option value="yaml">YAML</option>
                <option value="text">Text</option>
            </select>
        </div>
	</div> -->
	<!-- 沒有這個div會沒有文字輸入區塊 -->
    <!-- <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-template-editor2" ></div>
	</div> -->

	<!-- item容器的表單 -->
</script>

<!-- 定義節點的右邊資訊欄的輔助說明文字 -->
<script type="text/x-red" data-help-name="lower-case">
	<p>A simple node that converts the message payloads into all lower-case characters</p>
</script>